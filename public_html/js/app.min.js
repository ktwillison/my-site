// var sections = {
    var articlesHidden = false;
    var $wineExplorerSection = $(".content--wine-explorer");
    var maxWidthAromaWheel = 500;
// };

$(window).load(function(){
    cycleImages();
    resizeCarousel();
    setAromaWheelPadding();
});


var site = {
    init: function() {
        animation.init();
        addSmoothScroll();
        
        // Apply 'show more' script
        $(".content-main").find(".post-text").shorten({
            "showChars" : 400,
            "moreText"  : "<br><br>Read more",
            "lessText"  : "<br><br>Read less",
        });

        // Add links & animation to show/hide content
        $("a#show-wine-explorer").click(function() {
            hideMainArticles();
            $wineExplorerSection.toggleClass("hidden");
            animation.showSection($wineExplorerSection.find(".content"));
        });

        // Add animation to 'back' links to hide extra content
        $(".back-to-home").click(function() {
            if (articlesHidden){
                hideExtraArticles();
                showMainArticles();
            }
        });


        // Change image sizes for carousel on page resize
        $(window).on('resize', function(){
            resizeCarousel();
            setAromaWheelPadding();
        });
    }
};

$(function() {
    site.init()
});

var animation = {
    getElements: function() {
        $blockLeft = $(".block--left"),
        $blockLeftSocialIcon = $blockLeft.find(".block__social__link"), 
        $blockRight = $(".block--right"), 
        $content = $blockRight.find(".content-main").find(".content")
    },
    setElements: function() {
        animation.setBlockLeft();
        animation.setBlockRight();
    },
    setBlockLeft: function() {
        TweenMax.set($blockLeft, {
            xPercent: -100
        }), TweenMax.set($blockLeftSocialIcon, {
            autoAlpha: 0
        })
    },
    setBlockRight: function() {
        TweenMax.set($content, {
            y: 30,
            autoAlpha: 0
        })
    },
    slideContentIn: function() {
        var a = new TimelineMax;
        a.to($blockLeft, .1, {
            autoAlpha: 1
        }).to($blockLeft, 1.2, {
            xPercent: 0,
            ease: Power4.easeInOut,
            delay: .55,
            // onCompleteScope: $blockLeft
        }, "-= 1.1").staggerTo($blockLeftSocialIcon, .3, {
            autoAlpha: 1
        }, .05, "-= 0.1").staggerTo($content, .35, {
            y: 0,
            autoAlpha: 1,
            ease: Sine.easeOut
        }, .1, "-= 0.05")
    },
    hideSection: function($sectionContent) {
        var a = new TimelineMax;
        a.to($sectionContent, .35, {
            y: -30,
            autoAlpha: 1,
            ease: Sine.easeOut,
            delay: .55
        }, .1, "-= 0.05")
    },
    showSection: function($sectionContent) {
        TweenMax.set($sectionContent, {
            y: 30,
            autoAlpha: 0
        })

        var a = new TimelineMax;
        a.to($sectionContent, .35, {
            y: 0,
            autoAlpha: 1,
            ease: Sine.easeOut,
        }, .1, "-= 0.05")
    },
    init: function() {
        animation.getElements(), animation.setElements(), animation.slideContentIn();
    }
};

function hideMainArticles() {
    animation.hideSection($content);
    $(".content-main").toggleClass("hidden");
    articlesHidden = true;
    scrollToTop();
};

function showMainArticles() {
    animation.setBlockRight();
    $(".content-main").toggleClass("hidden");
    animation.showSection($content);
    articlesHidden = false;
    scrollToTop();
};

function hideExtraArticles() {
    animation.hideSection($wineExplorerSection.find(".content"));
    $wineExplorerSection.addClass("hidden");
};

function addSmoothScroll() {
	$(document).ready(function(){
      $("a.scrolling").on('click', function(event) {
        if (this.hash !== "") {
          // Prevent default anchor click behavior
          event.preventDefault();
          var hash = this.hash;
          $('html, body').animate({
                scrollTop: $(hash).offset().top
          }, 500, function(){
            // Add hash (#) to URL when done scrolling (default click behavior)
            // window.location.hash = hash;
          });
        }
      });
    });
};

function resizeCarousel(){
    var imageheight = $('.about-image:first').height();
    $('#image-carousel').css({'height':imageheight+'px'});
};

function cycleImages(){
    var $active = $('#image-carousel .active');
    var $next = ($active.next().length > 0) ? $active.next() : $('#image-carousel img:first');
    $next.css('z-index',2);//move the next image up the pile
    $active.fadeOut(1000,function(){//fade out the top image
    $active.css('z-index',1).show().removeClass('active');//reset the z-index and unhide the image
        $next.css('z-index',3).addClass('active');//make the next image the top one
    });

    setTimeout(cycleImages, 5000); // Change image every 5 seconds
};

function setAromaWheelPadding(){
    var $aromaWheel = $("#aroma_wheel.svg-container");
    var padding = parseInt($aromaWheel.css("padding-bottom"), 10);
    if (padding > maxWidthAromaWheel + 20) {
        $aromaWheel.css("padding-bottom", maxWidthAromaWheel + 20);
    }
};

function scrollToTop() {
    console.log("to top!");
    $("html, body").animate({ scrollTop: 0 }, "400");
};