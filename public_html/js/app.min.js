// var sections = {
    // $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    var articlesHidden = false;
    var $extraArtices = $("#article-specific-pages")
    var $wineExplorerSection = $("#wine-explorer-section");
    var $MLpdfSection = $("#ML-pdf-section");
// };

$(window).load(function(){
    cycleImages();
    resizeCarousel();
});


var site = {
    init: function() {
        animation.init();
        addSmoothScroll();
        
        // Apply 'show more' script
        $(".content-main").find(".post-text").shorten({
            "showChars" : 400,
            "moreText"  : "<br><br>Read more",
            "lessText"  : "<br><br>Read less",
        });

        // Add links & animation to show/hide content
        $( "a.show-wine-explorer" ).each(function(index) {
            $(this).on("click", function() {
                hideMainArticles();
                showExtraArticles();
                $wineExplorerSection.removeClass("hidden");
                animation.showSection($wineExplorerSection.find(".content"));
                renderWineExplorer();
            });
        });

        // Add links & animation to show/hide content
        $( "a.show-ML-page" ).each(function(index) {
            $(this).on("click", showMLPage);
        });

        $("a#show-ML-pdf").click(function() {
            showMLPage();
            scrollToID("ML-pdf-header");
        });

        // Add animation to 'back' links to hide extra content
        $(".back-to-home").click(function() {
            if (articlesHidden){
                hideExtraArticles();
                showMainArticles();
            }
        });


        // Change image sizes for carousel on page resize
        $(window).on('resize', function() {
            resizeCarousel();
            setAromaWheelPadding();
            if (!$MLpdfSection.hasClass("hidden")) {
                renderMLChart();
            }
        });

        function showMLPage(){
            hideMainArticles();
            showExtraArticles();
            $MLpdfSection.removeClass("hidden");
            animation.showSection($MLpdfSection.find(".content"));
            renderMLChart();
        };
    }
};

$(function() {
    site.init()
});

var animation = {
    getElements: function() {
        $blockLeft = $(".block--left"),
        $blockLeftSocialIcon = $blockLeft.find(".block__social__link"), 
        $blockRight = $(".block--right"), 
        $content = $blockRight.find(".content-main").find(".content")
    },
    setElements: function() {
        animation.setBlockLeft();
        animation.setBlockRight();
    },
    setBlockLeft: function() {
        TweenMax.set($blockLeft, {
            xPercent: -100
        }), TweenMax.set($blockLeftSocialIcon, {
            autoAlpha: 0
        })
    },
    setBlockRight: function() {
        TweenMax.set($content, {
            y: 30,
            autoAlpha: 0
        })
    },
    slideContentIn: function() {
        var a = new TimelineMax;
        a.to($blockLeft, .1, {
            autoAlpha: 1
        }).to($blockLeft, 1.2, {
            xPercent: 0,
            ease: Power4.easeInOut,
            delay: .55,
            // onCompleteScope: $blockLeft
        }, "-= 1.1").staggerTo($blockLeftSocialIcon, .3, {
            autoAlpha: 1
        }, .05, "-= 0.1").staggerTo($content, .35, {
            y: 0,
            autoAlpha: 1,
            ease: Sine.easeOut
        }, .1, "-= 0.05")
    },
    hideSection: function($sectionContent) {
        var a = new TimelineMax;
        a.to($sectionContent, .35, {
            y: -30,
            autoAlpha: 1,
            ease: Sine.easeOut,
            delay: .55
        }, .1, "-= 0.05")
    },
    showSection: function($sectionContent) {
        TweenMax.set($sectionContent, {
            y: 30,
            autoAlpha: 0
        })

        var a = new TimelineMax;
        a.to($sectionContent, .35, {
            y: 0,
            autoAlpha: 1,
            ease: Sine.easeOut,
        }, .1, "-= 0.05")
    },
    init: function() {
        animation.getElements(), animation.setElements(), animation.slideContentIn();
    }
};

function hideMainArticles() {
    animation.hideSection($content);
    $(".content-main").toggleClass("hidden");
    articlesHidden = true;
    scrollToID("page-content");
};

function showMainArticles() {
    animation.setBlockRight();
    $(".content-main").toggleClass("hidden");
    animation.showSection($content);
    articlesHidden = false;
    scrollToID("page-content");
    resizeCarousel();
};

function hideExtraArticles() {
    animation.hideSection($extraArtices.find(".content"));
    animation.hideSection($extraArtices.find(".back-to-home"));
    $wineExplorerSection.addClass("hidden");
    $MLpdfSection.addClass("hidden");
    $extraArtices.addClass("hidden");
};

function showExtraArticles() {
    animation.showSection($extraArtices.find(".back-to-home"));
    $extraArtices.removeClass("hidden");
};

function addSmoothScroll() {
	$(document).ready(function(){
      $("a.scrolling").on('click', function(event) {
        if (this.hash !== "") {
          // Prevent default anchor click behavior
          event.preventDefault();
          var hash = this.hash;
          $('html, body').animate({
                scrollTop: $(hash).offset().top
          }, 500, function(){
            // Add hash (#) to URL when done scrolling (default click behavior)
            // window.location.hash = hash;
          });
        }
      });
    });
};

function resizeCarousel(){
    var imageheight = $('.about-image:first').height();
    $(".image-carousel").each(function(index) {
        $(this).css({'height':imageheight+'px'});
    });
};

function cycleImages(){
    $(".image-carousel").each(function(index) {
        var $active = $(this).find('.active');
        var $next = ($active.next().length > 0) ? $active.next() : $(this).find('img:first');
        $next.css('z-index',2);//move the next image up the pile
        $active.fadeOut(1000,function(){//fade out the top image
        $active.css('z-index',1).show().removeClass('active');//reset the z-index and unhide the image
            $next.css('z-index',3).addClass('active');//make the next image the top one
        });
    });

    setTimeout(cycleImages, 5000); // Change image every 5 seconds
};


function scrollToID(idString) {
    $("html, body").animate({ scrollTop: $("#" + idString).offset().top }, 400);
};